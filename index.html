<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>Dota 2 Pro Timers</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --bg-dark: #050505;
      --card-bg: #121212;
    }

    body {
      font-family: 'Rajdhani', sans-serif;
      background: #000;
      color: #fff;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
    }

    .bg-ambient {
      position: fixed; inset: 0; z-index: -1;
      background: radial-gradient(circle at 50% 30%, #1e293b 0%, #000000 70%);
      pointer-events: none;
    }

    /* --- Header & Controls --- */
    .header-controls { position: fixed; top: 16px; right: 16px; z-index: 100; }
    .icon-btn {
      background: rgba(255,255,255,0.1); backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.2);
      color: #fff; width: 48px; height: 48px; border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem; cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }
    .icon-btn:hover { background: rgba(255,255,255,0.2); }

    /* --- Settings Modal --- */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.85); backdrop-filter: blur(12px);
      z-index: 200;
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
    }
    .modal-overlay.open { opacity: 1; pointer-events: auto; }
    .modal-content {
      width: 90%; max-width: 500px;
      background: #18181b; border: 1px solid #333; border-radius: 20px;
      padding: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.8);
    }
    .setting-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 12px 0; border-bottom: 1px solid #27272a;
    }
    .setting-row input {
      background: #000; border: 1px solid #3f3f46; color: #fbbf24;
      font-family: 'Rajdhani'; font-size: 1.3rem; font-weight: 700;
      width: 70px; text-align: center; padding: 6px; border-radius: 6px;
    }

    /* --- Layout --- */
    .container {
      width: 100%; max-width: 1200px; margin: 0 auto;
      padding: 80px 16px 40px 16px;
      display: flex; flex-direction: column; align-items: center; gap: 24px;
    }

    /* --- Hero Card (Top Timer) --- */
    .hero-card {
      width: 100%; max-width: 450px;
      background: rgba(20,20,20,0.6);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 24px; padding: 20px;
      display: flex; flex-direction: column; align-items: center;
      position: relative; overflow: hidden;
      box-shadow: 0 10px 40px -10px rgba(0,0,0,0.6);
    }
    .hero-bg { position: absolute; inset: 0; z-index: -1; opacity: 0.2; transition: background 0.5s; }
    .hero-time {
      font-size: 4.5rem; line-height: 1; font-weight: 700;
      text-shadow: 0 0 20px rgba(251, 191, 36, 0.3); margin: 10px 0;
    }

    /* --- Grid --- */
    .grid {
      display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; width: 100%;
    }
    @media(min-width: 768px) {
      .grid { grid-template-columns: repeat(3, 1fr); gap: 24px; }
    }

    /* --- Timer Card --- */
    .card {
      position: relative; aspect-ratio: 1 / 1;
      border-radius: 20px; background: #000; overflow: hidden;
      border: 2px solid rgba(255,255,255,0.1);
      transition: all 0.3s ease;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    
    .card-img {
      position: absolute; inset: 0; width: 100%; height: 100%;
      object-fit: cover; z-index: 0; transition: transform 0.5s;
    }
    .card-gradient {
      position: absolute; inset: 0; z-index: 1;
      /* Darker gradient to ensure text readability */
      background: radial-gradient(circle, rgba(0,0,0,0.5) 30%, rgba(0,0,0,0.85) 100%);
    }
    
    .card-content {
      position: relative; z-index: 10; width: 100%; height: 100%;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }

    .progress-container {
      position: relative; width: 85%; height: 85%;
      display: flex; align-items: center; justify-content: center;
    }
    .progress-ring {
      width: 100%; height: 100%;
      transform: rotate(-90deg);
    }
    .progress-ring circle {
      fill: transparent; stroke-width: 5; stroke-linecap: round;
    }
    
    .ring-track { stroke: rgba(255,255,255,0.1); }
    
    .ring-value { 
      stroke: var(--theme-color); 
      transition: stroke-dashoffset 0.2s linear;
    }

    .card-label {
      font-size: 1.1rem; font-weight: 700; text-transform: uppercase;
      color: #e4e4e7; text-shadow: 0 2px 4px #000; margin-bottom: -5px;
    }
    .card-time {
      position: absolute; font-size: 3.5rem; font-weight: 700; color: #fff;
      text-shadow: 0 4px 8px rgba(0,0,0,1);
    }

    /* --- STATE LOGIC --- */

    /* 1. STANDARD STATE (Waiting) */
    /* Not gray, but slightly dimmed so it doesn't distract too much */
    .card.inactive {
      opacity: 0.85; 
      transform: scale(0.98);
      border-color: rgba(255,255,255,0.1); 
    }
    .card.inactive .card-img {
      filter: brightness(0.7) saturate(0.8); /* Slight dim, but color remains */
    }
    .card.inactive .ring-value {
      filter: brightness(0.7); /* Ring is colored but not glowing */
    }

    /* 2. ACTIVE STATE (Alarm) */
    /* Pop, Glow, Pulse */
    .card.active {
      opacity: 1;
      transform: scale(1.03);
      border-color: var(--theme-color);
      box-shadow: 0 10px 40px -5px rgba(0,0,0,0.6), 0 0 25px var(--theme-color-dim);
      z-index: 20;
    }
    .card.active .card-img {
      filter: brightness(1.1) saturate(1.2);
      transform: scale(1.1);
    }
    .card.active .ring-value {
      filter: drop-shadow(0 0 8px var(--theme-color)); /* Neon Glow */
    }
    .card.active .card-time {
      text-shadow: 0 0 15px var(--theme-color);
    }

    /* Buttons */
    .btn {
      border: none; padding: 12px 16px; border-radius: 10px;
      font-weight: 700; font-family: 'Rajdhani'; font-size: 1rem;
      cursor: pointer; color: #fff; width: 100px;
    }
    .btn:active { transform: scale(0.96); }
    .hidden { display: none !important; }

  </style>
</head>
<body>

  <div class="bg-ambient"></div>
  <div class="header-controls"><button id="settings-btn" class="icon-btn">⚙️</button></div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal-overlay">
    <div class="modal-content">
      <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
        <h2 style="margin:0; font-size:1.8rem; color:#fbbf24;">ALARM TIMING</h2>
        <button id="close-settings" class="icon-btn" style="width:40px; height:40px;">✕</button>
      </div>
      <p style="color:#a1a1aa; margin-bottom:16px;">Set the second mark (remaining) when the alarm sounds.</p>
      <div id="settings-form"></div>
      <div style="margin-top:24px; text-align:center;">
        <button id="save-settings" class="btn" style="background:#10b981; width:100%;">DONE</button>
      </div>
    </div>
  </div>

  <div class="container">
    <h1 style="font-size:2.5rem; margin:0; text-align:center; letter-spacing:2px;">DOTA 2 TIMERS</h1>

    <!-- Pre-Game -->
    <div id="countdown-card" class="hero-card">
      <div class="hero-bg" style="background:#fbbf24;"></div>
      <div style="font-size:1.2rem; color:#fbbf24;">GAME STARTS IN</div>
      <div id="initial-time" class="hero-time" style="color:#fbbf24;">01:30</div>
      <div style="display:flex; gap:12px; margin-top:8px;">
        <button id="pre-left-btn" class="btn" style="background:#3b82f6;">WAIT<br><span style="font-size:0.8em">+5s</span></button>
        <button id="start-btn" class="btn" style="background:#10b981; flex:1;">START GAME</button>
        <button id="pre-right-btn" class="btn" style="background:#ef4444;">SKIP<br><span style="font-size:0.8em">-5s</span></button>
      </div>
    </div>

    <!-- Main Game Clock -->
    <div id="daynight-card" class="hero-card hidden">
      <div id="daynight-bg" class="hero-bg"></div>
      <div style="font-size:1.2rem; color:#fff;">GAME CLOCK</div>
      <div id="daynight-time" class="hero-time">00:00</div>
      <div style="display:flex; gap:12px; margin-top:8px;">
        <button id="game-left-btn" class="btn" style="background:#ef4444;">-5s</button>
        <button id="pause-btn" class="btn" style="background:#f59e0b; color:#000; flex:1;">PAUSE</button>
        <button id="resume-btn" class="btn hidden" style="background:#10b981; flex:1;">RESUME</button>
        <button id="game-right-btn" class="btn" style="background:#3b82f6;">+5s</button>
      </div>
    </div>

    <!-- The Grid -->
    <div id="timers-grid" class="grid"></div>
  </div>

<script>
const soundMap = {
  stack: "sounds/Stack.mp3",
  tormentor: "sounds/Tormentor.mp3",
  runes: "sounds/Runes.mp3",
  lotus: "sounds/Lotusandbounty.mp3",
  siege: "sounds/Catapult.mp3",
  exp: "sounds/EXPshrines.mp3",
  bell: "sounds/Bell.mp3"
};

const TIMERS = [
  {id:'stack',     label:'Stack Camps',   cycleSec:60,   warnBefore:30, color:'#34d399', img:'images/stack.png'},
  {id:'runes',     label:'Power Runes',   cycleSec:120,  warnBefore:28, color:'#60a5fa', img:'images/runes.png'},
  {id:'lotus',     label:'Lotus Pool',    cycleSec:180,  warnBefore:20, color:'#f472b6', img:'images/lotusnbounty.png'},
  {id:'siege',     label:'Siege Creeps',  cycleSec:300,  warnBefore:0,  color:'#ef4444', img:'images/siege.png'},
  {id:'exp',       label:'EXP Shrine',    cycleSec:420,  warnBefore:40, color:'#a78bfa', img:'images/expshrine.png'},
  {id:'tormentor', label:'Tormentor',     cycleSec:1200, warnBefore:45, color:'#fbbf24', img:'images/tormentor.png'}
];

// Audio
const audioCache = {};
for(const [k, v] of Object.entries(soundMap)){
  const a = new Audio(v); a.volume = 0.5; audioCache[k] = a;
}
function playSound(type) {
  if(audioCache.bell) { audioCache.bell.currentTime=0; audioCache.bell.play().catch(()=>{}); }
  if(audioCache[type]) { setTimeout(() => { audioCache[type].currentTime=0; audioCache[type].play().catch(()=>{}); }, 600); }
}

const RADIUS = 45;
const CIRCUMFERENCE = 2 * Math.PI * RADIUS;

function fmt(s){ return Math.floor(s/60).toString().padStart(2,'0')+':'+(s%60).toString().padStart(2,'0'); }

// Build UI
const grid = document.getElementById('timers-grid');
const settingsForm = document.getElementById('settings-form');
const cards = {};

TIMERS.forEach(t => {
  // Settings
  const row = document.createElement('div');
  row.className = 'setting-row';
  row.innerHTML = `<label>${t.label}</label><input type="number" id="input-${t.id}" value="${t.warnBefore}">`;
  settingsForm.appendChild(row);

  // Card
  const el = document.createElement('div');
  el.className = 'card inactive';
  el.style.setProperty('--theme-color', t.color);
  el.style.setProperty('--theme-color-dim', t.color + '60');
  
  el.innerHTML = `
    <img src="${t.img}" class="card-img" alt="${t.label}">
    <div class="card-gradient"></div>
    <div class="card-content">
      <div class="card-label" style="color:${t.color}">${t.label}</div>
      <div class="progress-container">
        <svg class="progress-ring" viewBox="0 0 100 100">
          <circle class="ring-track" cx="50" cy="50" r="${RADIUS}"></circle>
          <circle class="ring-value" id="ring-${t.id}" cx="50" cy="50" r="${RADIUS}" 
            stroke-dasharray="${CIRCUMFERENCE} ${CIRCUMFERENCE}" stroke-dashoffset="0"></circle>
        </svg>
        <div class="card-time" id="time-${t.id}">${fmt(t.cycleSec)}</div>
      </div>
    </div>
  `;
  grid.appendChild(el);

  cards[t.id] = {
    el, 
    time: el.querySelector(`#time-${t.id}`),
    ring: el.querySelector(`#ring-${t.id}`),
    cycle: t.cycleSec,
    isActive: false
  };
});

// Settings Logic
const modal = document.getElementById('settings-modal');
document.getElementById('settings-btn').onclick = () => modal.classList.add('open');
document.getElementById('close-settings').onclick = () => modal.classList.remove('open');
document.getElementById('save-settings').onclick = () => {
  TIMERS.forEach(t => {
    const val = parseInt(document.getElementById(`input-${t.id}`).value);
    if(!isNaN(val)) t.warnBefore = val;
  });
  modal.classList.remove('open');
};

// Game Logic
let gameTime = 0;
let isPaused = false;
const timerStates = {};
TIMERS.forEach(t => timerStates[t.id] = { start: 0, hasWarned: false });

function updateTimers() {
  TIMERS.forEach(t => {
    const st = timerStates[t.id];
    const elapsed = gameTime - st.start;
    let remain = t.cycleSec - (elapsed % t.cycleSec);
    if(remain <= 0) remain = t.cycleSec;

    // Text & Ring
    cards[t.id].time.textContent = fmt(remain);
    const offset = CIRCUMFERENCE * (1 - (remain / t.cycleSec));
    cards[t.id].ring.style.strokeDashoffset = offset;

    // Active State Logic
    let trigger = false;
    if (t.warnBefore > 0 && remain === t.warnBefore && !st.hasWarned) trigger = true;
    if (t.warnBefore === 0 && elapsed > 0 && elapsed % t.cycleSec === 0 && !st.hasWarned) trigger = true;

    if (trigger) {
      playSound(t.id);
      st.hasWarned = true;
      cards[t.id].isActive = true;
      cards[t.id].el.classList.remove('inactive');
      cards[t.id].el.classList.add('active');
    }

    // Deactivate when timer resets
    if (cards[t.id].isActive && remain === t.cycleSec && st.hasWarned && elapsed > t.warnBefore) {
       cards[t.id].isActive = false;
       st.hasWarned = false;
       st.start = gameTime;
       cards[t.id].el.classList.remove('active');
       cards[t.id].el.classList.add('inactive');
    }
    
    // Safety
    if (elapsed > 0 && elapsed % t.cycleSec === 0) st.start = gameTime;
  });

  const isDay = Math.floor(gameTime / 300) % 2 === 0;
  document.getElementById('daynight-time').textContent = fmt(gameTime);
  document.getElementById('daynight-bg').style.background = isDay ? '#fbbf24' : '#3b82f6';
}

function startGameClock() {
  gameTime = 0;
  isPaused = false;
  TIMERS.forEach(t => timerStates[t.id] = { start: 0, hasWarned: false });
  updateTimers();
  setInterval(() => { if(!isPaused) { gameTime++; updateTimers(); } }, 1000);
}

// Pre-Game
let preTime = 90;
let preRunning = false;
const preEl = document.getElementById('initial-time');
function updatePre() { preEl.textContent = fmt(preTime); }

document.getElementById('pre-left-btn').onclick = () => { if(preRunning) { preTime += 5; updatePre(); } };
document.getElementById('pre-right-btn').onclick = () => { if(preRunning) { preTime = Math.max(1, preTime-5); updatePre(); } };

document.getElementById('start-btn').onclick = function() {
  if(preRunning) return;
  preRunning = true;
  this.style.opacity = "0.5"; this.textContent = "RUNNING...";
  const tick = setInterval(() => {
    preTime--;
    updatePre();
    if(preTime <= 0) {
      clearInterval(tick);
      document.getElementById('countdown-card').classList.add('hidden');
      document.getElementById('daynight-card').classList.remove('hidden');
      startGameClock();
    }
  }, 1000);
};

// Controls
document.getElementById('pause-btn').onclick = () => { isPaused = true; document.getElementById('pause-btn').classList.add('hidden'); document.getElementById('resume-btn').classList.remove('hidden'); };
document.getElementById('resume-btn').onclick = () => { isPaused = false; document.getElementById('resume-btn').classList.add('hidden'); document.getElementById('pause-btn').classList.remove('hidden'); };
document.getElementById('game-right-btn').onclick = () => { gameTime += 5; updateTimers(); };
document.getElementById('game-left-btn').onclick = () => { gameTime = Math.max(0, gameTime-5); updateTimers(); };
</script>
</body>
</html>
