<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dota 2 Timers — Local Sounds + Custom Alarms</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --card-size:160px;
      --ring-size:110px;
      --grid-gap:6px;
      --bg:#0b1020;
    }
    body {
      font-family:'Inter',sans-serif;
      background:var(--bg);
      color:#F3F4F6;
      margin:0;
      padding:18px;
      display:flex;
      justify-content:center;
    }
    .app {
      width:100%;
      max-width:1200px;
      display:flex;
      flex-direction:row;
      gap:20px;
    }
    .sidebar {
      width:220px;
      background:#111827;
      border:1px solid #2b3344;
      border-radius:0.6rem;
      padding:12px;
      box-shadow:0 6px 16px rgba(0,0,0,0.4);
    }
    .sidebar h2 { font-size:1rem; font-weight:800; margin-bottom:10px; }
    .sidebar label { display:block; margin-bottom:8px; font-size:0.85rem; }
    .sidebar input {
      width:60px; margin-left:6px; padding:2px 4px;
      border-radius:4px; border:1px solid #444;
      background:#0b1020; color:#fff;
    }
    .main { flex:1; display:flex; flex-direction:column; align-items:center; gap:12px; }
    .grid {
      display:grid;
      grid-template-columns: repeat(3, var(--card-size));
      grid-auto-rows: var(--card-size);
      gap: var(--grid-gap);
      justify-content:center;
      align-items:center;
      margin-top:8px;
    }
    .timer-card {
      width:var(--card-size); height:var(--card-size);
      border-radius:0.7rem; overflow:hidden;
      background:#0f1724; border:1px solid #222832;
      box-shadow:0 8px 22px rgba(0,0,0,0.45);
      display:flex; flex-direction:column;
      justify-content:center; align-items:center;
      position:relative;
      transition:filter .16s ease, transform .12s ease, box-shadow .18s ease, border .18s ease;
    }
    .timer-overlay { position:absolute; inset:0; background:linear-gradient(180deg, rgba(0,0,0,0.64), rgba(0,0,0,0.78)); z-index:2; pointer-events:none; }
    .timer-content { position:relative; z-index:3; width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:8px; box-sizing:border-box; text-align:center; }
    .timer-label { font-weight:800; font-size:0.92rem; color:#fff; margin-bottom:6px; text-shadow:0 1px 1px rgba(0,0,0,0.6); }
    .ring { width:var(--ring-size); height:var(--ring-size); border-radius:50%; position:relative; display:flex; align-items:center; justify-content:center; z-index:3; background:conic-gradient(from -90deg, rgba(255,255,255,0.06) 0% 100%); box-shadow:inset 0 0 12px rgba(0,0,0,0.65); transition:background 300ms linear, box-shadow 220ms ease; }
    .ring-inner { width:66%; height:66%; border-radius:50%; background:var(--bg); display:flex; align-items:center; justify-content:center; box-shadow:inset 0 0 10px rgba(0,0,0,0.6); }
    .ring-time { font-weight:900; font-size:1.02rem; color:#fff; text-shadow:0 2px 4px rgba(0,0,0,0.6); }
    .timer-card.inactive { filter:brightness(0.55) saturate(0.7); }
    .timer-card.inactive .ring { box-shadow:inset 0 0 16px rgba(0,0,0,0.8); background:conic-gradient(from -90deg, rgba(0,0,0,0.55) 0% 100%); }
    .timer-card.inactive .ring-time { color:#bfc5cc; }
    .timer-card.active { border:2px solid #ffffff; box-shadow:0 20px 48px rgba(0,0,0,0.6), 0 0 18px rgba(255,255,255,0.06) inset, 0 0 14px rgba(255,255,255,0.18); transform:translateY(-3px); }
    .center-card { width:320px; height:320px; border-radius:1rem; background:#0f1724; border:1px solid #222832; box-shadow:0 18px 36px rgba(0,0,0,0.45); display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden; }
    .hidden { display:none; }
    .alarm-marker {
  position: absolute;
  width: 2px;
  height: 50%;
  background: #fbbf24; /* yellow marker */
  top: 0;
  left: 50%;
  transform-origin: bottom center;
  z-index: 4;
}
  </style>
</head>
<body>
  <div class="app">
    <!-- Sidebar for alarm settings -->
    <div class="sidebar">
      <h2>Alarm Settings (seconds)</h2>
      <form id="alarm-settings">
        <label>Stacking Camps: <input type="number" id="stack-input" value="30"></label>
        <label>Power Runes: <input type="number" id="runes-input" value="28"></label>
        <label>Lotus Pool: <input type="number" id="lotus-input" value="20"></label>
        <label>Siege Creeps: <input type="number" id="siege-input" value="0"></label>
        <label>EXP Shrine: <input type="number" id="exp-input" value="40"></label>
        <label>Tormentor: <input type="number" id="tormentor-input" value="45"></label>
      </form>
    </div>

    <!-- Main timers -->
    <div class="main">
      <header>
        <h1 style="font-weight:900;font-size:1.2rem;margin:0;">Dota 2 Timers</h1>
        <div style="color:#9CA3AF;font-size:0.88rem;">Local sounds • Custom alarms • Active glow</div>
      </header>

      <!-- Pre-game countdown -->
      <div id="countdown-card" class="center-card">
        <div class="timer-overlay"></div>
        <div class="timer-content" style="flex-direction:column;">
          <div style="font-weight:900;font-size:1.05rem;color:#fbbf24;margin-bottom:8px;">Game starts in...</div>
          <div id="ring-initial" class="ring" style="width:220px;height:220px;">
            <div class="ring-inner" style="width:170px;height:170px;">
              <div id="initial-time" class="ring-time" style="color:#111827;font-size:1.6rem;">01:30</div>
            </div>
          </div>
          <div class="controls" style="margin-top:12px;">
            <button id="minus5-initial" class="btn" style="background:#dc2626;color:#fff">-5s</button>
            <button id="start-btn" class="btn" style="background:#16a34a;color:#fff">Start</button>
            <button id="plus5-initial" class="btn" style="background:#2563eb;color:#fff">+5s</button>
          </div>
        </div>
      </div>
        <!-- Day/Night -->
      <div id="daynight-card" class="center-card hidden">
        <div class="timer-overlay"></div>
        <div class="timer-content" style="flex-direction:column;">
          <div style="font-weight:900;font-size:1.02rem;color:#fff;margin-bottom:8px;">Day / Night</div>
          <div id="ring-daynight" class="ring" style="width:220px;height:220px;">
            <div class="ring-inner" style="width:170px;height:170px;">
              <div id="daynight-time" class="ring-time" style="font-size:1.6rem;">00:00</div>
            </div>
          </div>
          <div class="controls" style="margin-top:12px;">
            <button id="minus5-game" class="btn" style="background:#dc2626;color:#fff">-5s</button>
            <button id="pause-btn" class="btn" style="background:#f59e0b;color:#111827">Pause</button>
            <button id="resume-btn" class="btn hidden" style="background:#16a34a;color:#fff">Resume</button>
            <button id="plus5-game" class="btn" style="background:#2563eb;color:#fff">+5s</button>
          </div>
        </div>
      </div>

      <!-- Grid of timers -->
      <div id="timers-grid" class="grid"></div>
    </div>
  </div>

<script>
// ---------- Utilities ----------
function fmt(sec){const m=Math.floor(sec/60).toString().padStart(2,'0');const s=(sec%60).toString().padStart(2,'0');return `${m}:${s}`;}
function ringStyle(color,frac){const pct=Math.max(0,Math.min(1,frac))*100;return `conic-gradient(from -90deg, ${color} 0% ${pct}%, rgba(255,255,255,0.12) ${pct}% 100%)`;}

// ---------- Sound Preloading ----------
const soundMap={
  stack:"sounds/Stack.mp3",
  tormentor:"sounds/Tormentor.mp3",
  runes:"sounds/Runes.mp3",
  lotus:"sounds/Lotusandbounty.mp3",
  siege:"sounds/Catapult.mp3",
  exp:"sounds/EXPshrines.mp3",
  bell:"sounds/Bell.mp3"
};
const preloadedSounds={};
for(const [key,path] of Object.entries(soundMap)){
  const audio=new Audio(path);
  audio.preload="auto";
  audio.volume=0.3;
  preloadedSounds[key]=audio;
}

// ---------- Playback ----------
function playAlarm(tag){
  // play bell first
  const bell=preloadedSounds.bell;
  if(bell){bell.currentTime=0;bell.play();}
  // then play category sound
  const sound=preloadedSounds[tag];
  if(sound){setTimeout(()=>{sound.currentTime=0;sound.play();},500);}
}

// ---------- Timers definition ----------
const TIMERS=[
  {id:'stack',label:'Stacking Camps',cycleSec:60,warnBefore:30,color:'#34d399'},
  {id:'runes',label:'Power Runes',cycleSec:120,warnBefore:28,color:'#60a5fa'},
  {id:'lotus',label:'Lotus Pool',cycleSec:180,warnBefore:20,color:'#f59e0b'},
  {id:'siege',label:'Siege Creeps',cycleSec:300,warnBefore:0,color:'#ef4444'},
  {id:'exp',label:'EXP Shrine',cycleSec:420,warnBefore:40,color:'#a78bfa'},
  {id:'tormentor',label:'Tormentor',cycleSec:1200,warnBefore:45,color:'#fb7185'}
];

// ---------- Build grid ----------
const grid=document.getElementById('timers-grid');
const cards={};
TIMERS.forEach(t=>{
  const card=document.createElement('div');
  card.className='timer-card inactive';
  card.innerHTML=`
    <div class="timer-overlay"></div>
    <div class="timer-content">
      <div class="timer-label">${t.label}</div>
      <div class="ring" id="ring-${t.id}">
        <div class="ring-inner"><div class="ring-time" id="time-${t.id}">${fmt(t.cycleSec)}</div></div>
      </div>
    </div>`;
  grid.appendChild(card);
  cards[t.id]={cardEl:card,ringEl:card.querySelector(`#ring-${t.id}`),timeEl:card.querySelector(`#time-${t.id}`),color:t.color};
});

// ---------- Sidebar input hook ----------
document.getElementById('alarm-settings').addEventListener('input',()=>{
  TIMERS.forEach(t=>{
    const input=document.getElementById(`${t.id}-input`);
    if(input){t.warnBefore=parseInt(input.value,10);}
  });
});

// ---------- Pre-game countdown ----------
let initialCountdown=90,initialLeft=initialCountdown,countdownRunning=false;
const initialTimeEl=document.getElementById('initial-time');
const ringInitial=document.getElementById('ring-initial');
function updateInitialUI(){initialTimeEl.textContent=fmt(initialLeft);ringInitial.style.background=ringStyle('#fbbf24',initialLeft/initialCountdown);}
document.getElementById('minus5-initial').onclick=()=>{if(!countdownRunning)return;initialLeft=Math.max(1,initialLeft-5);updateInitialUI();};
document.getElementById('plus5-initial').onclick=()=>{if(!countdownRunning)return;initialLeft=Math.min(600,initialLeft+5);updateInitialUI();};
document.getElementById('start-btn').onclick=()=>{
  countdownRunning=true;initialLeft=initialCountdown;updateInitialUI();
  const tick=setInterval(()=>{
    if(!countdownRunning){clearInterval(tick);return;}
    initialLeft--;updateInitialUI();
    if(initialLeft<=0){clearInterval(tick);document.getElementById('countdown-card').classList.add('hidden');document.getElementById('daynight-card').classList.remove('hidden');startGame();}
  },1000);
};

// ---------- Game model ----------
let gameElapsed=0,paused=false;
const cycles={};
const daynightTime=document.getElementById('daynight-time');
const ringDayNight=document.getElementById('ring-daynight');

function refreshDayNight(){
  daynightTime.textContent=fmt(gameElapsed);
  const secIntoBlock=gameElapsed%600;
  const remainingToMark=600-secIntoBlock;
  const isDay=Math.floor(gameElapsed/600)%2===0;
  ringDayNight.style.background=ringStyle(isDay?'#facc15':'#22d3ee',remainingToMark/600);
}

function refreshTimers(){
  TIMERS.forEach(t=>{
    const c=cycles[t.id];
    const elapsedInCycle=gameElapsed-c.startGameSec;
    let remaining=t.cycleSec-(elapsedInCycle%t.cycleSec);
    if(remaining<=0||remaining>t.cycleSec)remaining=t.cycleSec;
    cards[t.id].timeEl.textContent=fmt(remaining);
    cards[t.id].ringEl.style.background=ringStyle(cards[t.id].color,remaining/t.cycleSec);
    if(c.highlightedUntil&&gameElapsed>=c.highlightedUntil){
      cards[t.id].cardEl.classList.remove('active');cards[t.id].cardEl.classList.add('inactive');
      c.highlightedUntil=null;c.warned=false;
    }
    if(elapsedInCycle%t.cycleSec===0&&elapsedInCycle>0&&!c.highlightedUntil){
      cards[t.id].cardEl.classList.remove('active');cards[t.id].cardEl.classList.add('inactive');
      c.warned=false;
    }
  });
}

function startGame(){
  gameElapsed = 0;
  paused = false;
  TIMERS.forEach(t=>{
    cycles[t.id] = {
      startGameSec: gameElapsed,
      cycleSec: t.cycleSec,
      warned: false,
      highlightedUntil: null
    };
  });
  refreshDayNight();
  refreshTimers();

  setInterval(()=>{
    if(!paused) gameElapsed++;
    refreshDayNight();

    if(gameElapsed % 600 === 541) playAlarm('bell');

    TIMERS.forEach(t=>{
      const c = cycles[t.id];
      const elapsedInCycle = gameElapsed - c.startGameSec;
      let remaining = t.cycleSec - (elapsedInCycle % t.cycleSec);
      if(remaining <= 0 || remaining > t.cycleSec) remaining = t.cycleSec;

      if(t.warnBefore > 0 && remaining === t.warnBefore && !c.warned){
        playAlarm(t.id);
        c.warned = true;
        c.highlightedUntil = gameElapsed + remaining;
        cards[t.id].cardEl.classList.remove('inactive');
        cards[t.id].cardEl.classList.add('active');
      }

      if(t.warnBefore === 0 && elapsedInCycle % t.cycleSec === 0 && elapsedInCycle > 0 && !c.warned){
        playAlarm(t.id);
        c.warned = true;
        c.highlightedUntil = gameElapsed + t.cycleSec;
        cards[t.id].cardEl.classList.remove('inactive');
        cards[t.id].cardEl.classList.add('active');
      }

      if(elapsedInCycle % t.cycleSec === 0 && elapsedInCycle > 0){
        c.startGameSec = gameElapsed;
      }
    });

    refreshTimers();
  }, 1000);
}
// ---------- Pause/Resume ----------
document.getElementById('pause-btn').onclick = () => {
  paused = true;
  document.getElementById('pause-btn').classList.add('hidden');
  document.getElementById('resume-btn').classList.remove('hidden');
};

document.getElementById('resume-btn').onclick = () => {
  paused = false;
  document.getElementById('resume-btn').classList.add('hidden');
  document.getElementById('pause-btn').classList.remove('hidden');
};

// ---------- Adjust game time ----------
function adjustGameTime(deltaSec) {
  gameElapsed = Math.max(0, gameElapsed + deltaSec);
  refreshDayNight();
  refreshTimers();
}

document.getElementById('minus5-game').onclick = () => adjustGameTime(-5);
document.getElementById('plus5-game').onclick = () => adjustGameTime(+5);
</script>
</body>
</html>
